{% extends 'base.html' %}

{% block title %}
<title>Main page</title>
{% endblock %}

{% block body %}
<div class="mx-auto p-2">

<a href="/fruits" class="btn btn-primary btn-sm my-3">Buy fruits</a>
{% if not username or not email %}

<p class="my-2">
<button class="btn btn-primary btn-sm" id="accb" style="display:none;" onclick="accountform()">Créér un compte</button>
<button class="btn btn-primary btn-sm" id="logb" onclick="loginform()">Se connecter</button>
</p>
<form id="form" action="/" method="POST">
    <fieldset class="d-inline border border-primary-subtle rounded-1 p-2 bg-primary-subtle text-primary-emphasis bg-opacity-75">
        <legend id="formlegend">Créer un compte:</legend>
    <p>Username: <input required id="username" name="username" minlength="3" maxlength="25" pattern="[A-Za-z0-9]{3,25}"></p>
    <p id="emailsp">Email: <input required id="email" type="email" name="email"></p>
    <p>Password: <input required id="password" type="password" name="password" minlength="10"></p>
    <input id="subut" class="btn btn-secondary btn-sm" type="submit" value="Créer">
</fieldset>
</form>

{% endif %}

{% with messages = get_flashed_messages() %}
<br>
{% if messages %}
{% for message in messages %}
{{ message|safe }}
{% endfor %}
{% endif %}
{% endwith %}

{% if username and email %}
<h1>
Bonjour {{username}} <br>
Adresse mail : {{email}} <br>
nombre de visites: {{visit_count}}
</h1>

<a href="/logout"><button class="btn-danger btn btn-sm">Déconnexion</button></a>
{% endif %}
<br>
{{ session_id }}
</div>
<script type="text/javascript">
    function loginform(){
        $('#formlegend').text("Se connecter:");
        $('#email').prop('disabled', true);
        $('#form').attr('action', "/login");
        $('#emailsp').hide();
        $('#logb').hide();
        $('#accb').show();
        $('#subut').val("Connexion");
    }
    function accountform(){
        $('#formlegend').text("Créer un compte:");
        $('#email').prop('disabled', false);
        $('#form').attr('action', "/");
        $('#emailsp').show();
        $('#accb').hide();
        $('#logb').show();
        $('#subut').val("Créer");
    }
</script>

{% endblock %}
